<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roulette Driest 5 Corners - 1.23</title>
<style>
  :root{--bg:#0f1720;--card:#0e2230;--muted:#98a0b3;--accent:#2b7cff;--pill:#112233}
  body{font-family:Inter,system-ui,Arial;background:var(--bg);color:#fff;margin:0;padding:18px}
  h1{font-size:22px;margin:6px 0 12px}
  .card{background:linear-gradient(180deg,#0b1620,#08121a);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,.6)}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  button{background:var(--card);border:1px solid rgba(255,255,255,.04);color:#fff;padding:8px 10px;border-radius:10px;cursor:pointer}
  .kbd{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:8px}
  .num{padding:10px;text-align:center;border-radius:10px;background:#061020;cursor:pointer;border:1px solid rgba(255,255,255,.03)}
  textarea{width:100%;min-height:70px;border-radius:10px;padding:8px;background:#081424;border:1px solid rgba(255,255,255,.03);color:#cfe}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.03);color:var(--muted);margin-right:8px}
  .corner-line{font-weight:700;letter-spacing:.5px}
  .flag-RED{color:#ff6b6b}
  .flag-ORANGE{color:#ffb86b}
  .flag-YELLOW{color:#ffd86b}
  .flag-GREEN{color:#8ce58c}
  .small{font-size:13px;color:var(--muted)}
  .activate{float:right}
  footer{margin-top:18px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<h1>Roulette Trend Tracker — Driest 5 Corners (non-overlap) v1.23 → 1.23 (patchable)</h1>

<div class="card">
  <div class="row">
    <div class="pill">Build: 2026-01-13</div>
    <div class="pill">LOCKED:1.23</div>
  </div>
  <div style="height:8px"></div>
  <div class="small">Quick input / paste CSV (numbers 0,00 as 0 or 99)</div>
  <textarea id="csvIn" placeholder="Paste CSV or enter numbers separated by commas"></textarea>
  <div style="height:8px"></div>
  <div>
    <button id="importBtn">Import spins (append)</button>
    <button id="clearBtn">Clear spins</button>
  </div>
  <div style="height:12px"></div>
  <div class="small">Tap keypad (00 maps to 99)</div>
  <div class="kbd" id="keypad"></div>
  <div style="height:12px"></div>
  <div class="small">Last spins (newest first):</div>
  <div id="lastSpins" class="small" style="padding:8px;background:#07111a;border-radius:8px;margin-top:6px"></div>
</div>

<div class="card" id="trendCard">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <div><strong>Trend + tracking</strong></div>
    <div><button id="hideWheelBtn">Hide wheel-wave</button></div>
  </div>

  <div style="height:10px"></div>
  <div id="driestCard">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div><strong>Driest 5 Corners (running — non-overlap)</strong></div>
      <div><button id="activateBtn" class="activate">Activate</button></div>
    </div>
    <div style="height:8px"></div>
    <div id="driestList" class="corner-line">—</div>
    <div id="driestHelp" class="small" style="margin-top:6px">LIVE — Tap Activate to freeze current top 5 (auto-resets after 2 hits).</div>
  </div>
</div>

<footer>
  This file is a standalone patch implementing 12 non-overlapping corners and drier-first ranking.
</footer>

<script>
/* ---------- Configuration: 12 non-overlapping corners (user-supplied) ---------- */
// Using canonical 4-number corner groups that map to the user's 12 pair list.
// For display we will show "pair" as first/last in the group (e.g., 1/5, 7/11 ...).
const NON_OVL_CORNERS = [
  [1,2,4,5],   // label -> 1/5
  [7,8,10,11], // 7/11
  [13,14,16,17],
  [19,20,22,23],
  [25,26,28,29],
  [31,32,34,35],
  [2,3,5,6],   // 2/6
  [8,9,11,12], // 8/12
  [14,15,17,18],
  [20,21,23,24],
  [26,27,29,30],
  [32,33,35,36]
];

function cornerShortLabel(nums){
  const s = nums.slice().sort((a,b)=>a-b);
  return `${s[0]}/${s[s.length-1]}`;
}

/* ---------- State ---------- */
let spins = []; // oldest first; newest at end
const GREEN_EQ = 99; // represent 00 as 99 for internal logic

/* freeze state */
let freezeState = { isActive:false, frozen:[], hitCount:0, hitIds:{} };

/* ---------- UI wiring ---------- */
const keypadRoot = document.getElementById('keypad');
const lastSpinsEl = document.getElementById('lastSpins');
const driestList = document.getElementById('driestList');
const activateBtn = document.getElementById('activateBtn');
const importBtn = document.getElementById('importBtn');
const clearBtn = document.getElementById('clearBtn');
const csvIn = document.getElementById('csvIn');
const hideWheelBtn = document.getElementById('hideWheelBtn');

function buildKeypad(){
  const nums = ['00','0'].concat(Array.from({length:36},(_,i)=>String(i+1)));
  nums.forEach(n=>{
    const b = document.createElement('div');
    b.className='num';
    b.textContent = n;
    b.addEventListener('click',()=>{ handleSpinInput(n); });
    keypadRoot.appendChild(b);
  });
}
buildKeypad();

function handleSpinInput(raw){
  let val = raw==='00' ? GREEN_EQ : Number(raw);
  appendSpin(val);
}

function appendSpin(num){
  spins.push(num);
  renderAll();
  if(freezeState.isActive){
    const res = updateFreezeOnSpin(freezeState, num);
    freezeState = res.next;
    if(res.resetTriggered){
      freezeState = deactivateFreeze();
      alert('Freeze auto-reset after 2 hits');
    }
  }
}

/* ---------- Import / Clear ---------- */
importBtn.addEventListener('click',()=>{
  const text = csvIn.value.trim();
  if(!text) return alert('Paste CSV first');
  const toks = text.split(/[\s,]+/).map(x=>x.trim()).filter(Boolean);
  for(const t of toks){
    if(t==='00'){ spins.push(GREEN_EQ); continue; }
    const n = Number(t);
    if(Number.isNaN(n)) continue;
    spins.push(n);
  }
  renderAll();
});
clearBtn.addEventListener('click',()=>{
  spins = [];
  freezeState = { isActive:false, frozen:[], hitCount:0, hitIds:{} };
  renderAll();
});

/* ---------- Freeze helpers ---------- */
function initFreezeState(){ return { isActive:false, frozen:[], hitCount:0, hitIds:{} }; }
function activateFreeze(snapshot){
  const hitIds = {};
  for(const c of snapshot.top5) hitIds[c.id] = false;
  return { isActive:true, frozen:snapshot.top5, hitCount:0, hitIds };
}
function deactivateFreeze(){ return initFreezeState(); }
function updateFreezeOnSpin(state, spin){
  if(!state.isActive) return { next: state, resetTriggered:false, hitThisSpin:[] };
  const hitThisSpin = [];
  for(const c of state.frozen){
    if(state.hitIds[c.id]) continue;
    if(spin===0 || spin===GREEN_EQ) continue;
    if(c.nums.includes(spin)) hitThisSpin.push(c.id);
  }
  if(hitThisSpin.length===0) return { next: state, resetTriggered:false, hitThisSpin };
  let hitCount = state.hitCount;
  const hitIds = {...state.hitIds};
  for(const id of hitThisSpin){ if(!hitIds[id]){ hitIds[id]=true; hitCount+=1; } }
  if(hitCount>=2) return { next: deactivateFreeze(), resetTriggered:true, hitThisSpin };
  return { next: {...state, hitCount, hitIds}, resetTriggered:false, hitThisSpin };
}

/* ---------- Compute driest ---------- */
function ageToFlag(age){
  if(age==null) return 'RED';
  if(age>=20) return 'RED';
  if(age>=15) return 'ORANGE';
  if(age>=10) return 'YELLOW';
  return 'GREEN';
}
function setFlagFromTop5(top5){
  const maxAge = Math.max(...top5.map(c=> c.since==null?999999:c.since));
  return ageToFlag(maxAge);
}

function computeRunningDriest5(spinsInSession){
  const counts = new Map();
  const lastHitIdx = new Map();
  for(const c of NON_OVL_CORNERS) counts.set(cornerId(c),0);
  for(let i=0;i<spinsInSession.length;i++){
    const s = spinsInSession[i];
    if(s===0 || s===GREEN_EQ) continue;
    for(const corner of NON_OVL_CORNERS){
      if(corner.includes(s)){
        const id = cornerId(corner);
        counts.set(id, (counts.get(id)||0)+1);
        lastHitIdx.set(id, i);
      }
    }
  }
  const nowIdx = spinsInSession.length-1;
  const stats = NON_OVL_CORNERS.map(corner=>{
    const id = cornerId(corner);
    const label = cornerShortLabel(corner);
    const cnt = counts.get(id)||0;
    const lh = lastHitIdx.get(id);
    const since = (lh==null) ? null : (nowIdx - lh);
    const flag = ageToFlag(since);
    return { id, label, nums:corner, count:cnt, since, flag };
  });
  stats.sort((a,b)=>{
    if(a.count!==b.count) return a.count - b.count;
    const aSince = a.since==null?999999:a.since;
    const bSince = b.since==null?999999:b.since;
    return bSince - aSince;
  });
  const top5 = stats.slice(0,5);
  return { top5 };
}
function cornerId(nums){ return nums.slice().sort((a,b)=>a-b).join(','); }

/* ---------- Rendering ---------- */
function renderLastSpins(){
  if(spins.length===0){ lastSpinsEl.textContent = '—'; return; }
  const shown = spins.slice(-20).slice().reverse().map(v=> v===GREEN_EQ ? '00' : String(v));
  lastSpinsEl.textContent = shown.join(', ');
}
function renderDriest(){
  const snapshot = computeRunningDriest5(spins);
  if(freezeState.isActive){
    const parts = freezeState.frozen.map(c=>{
      const hit = freezeState.hitIds[c.id] ? ' ✓' : '';
      return `<span class="flag-${c.flag}">${c.label} (${c.since==null?'NA':c.since})${hit}</span>`;
    });
    driestList.innerHTML = parts.join(' / ');
    activateBtn.textContent = 'Deactivate';
    driestHelp.textContent = `ACTIVE — Hits: ${freezeState.hitCount}/2`;
  } else {
    const parts = snapshot.top5.map(c=> `<span class="flag-${c.flag}">${c.label} (${c.since==null?'NA':c.since})</span>`);
    driestList.innerHTML = parts.join(' / ');
    activateBtn.textContent = 'Activate';
    driestHelp.textContent = `LIVE — Tap Activate to freeze current top 5 (auto-resets after 2 hits).`;
  }
}

activateBtn.addEventListener('click',()=>{
  if(!freezeState.isActive){
    const snapshot = computeRunningDriest5(spins);
    freezeState = activateFreeze(snapshot);
    renderDriest();
  } else {
    freezeState = deactivateFreeze();
    renderDriest();
  }
});

hideWheelBtn.addEventListener('click',()=>{
  alert('Wheel wave removed/hidden by this patch.');
});

function renderAll(){ renderLastSpins(); renderDriest(); }
renderAll();

/* debug */
window._debug = { spins, computeRunningDriest5, NON_OVL_CORNERS };
</script>
</body>
</html>
