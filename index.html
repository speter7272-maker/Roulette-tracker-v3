<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roulette Trend Tracker • Build: 2025-12-30 • working keypad</title>
  <style>
    :root{color-scheme:dark; --bg:#0b1220; --card:#0f1a2e; --muted:#94a3b8; --txt:#e5e7eb; --border:#1f2a44; --chip:#111c33; --accent:#60a5fa;}
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#070b14,#0b1220 40%,#070b14);color:var(--txt)}
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 40px}
    .card{background:rgba(15,26,46,.88);border:1px solid var(--border);border-radius:16px;padding:14px;margin:12px 0;box-shadow:0 8px 28px rgba(0,0,0,.25)}
    h1{font-size:20px;margin:0 0 6px}
    .sub{color:var(--muted);font-size:12px;line-height:1.35}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:8px 10px;font-size:12px;color:var(--muted)}
    .pill b{color:var(--txt)}
    .btn{appearance:none;border:1px solid var(--border);background:var(--chip);color:var(--txt);padding:10px 12px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{border-color:rgba(96,165,250,.45);background:rgba(96,165,250,.18)}
    .btn.danger{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.12)}
    input[type="text"]{width:100%;border-radius:14px;border:1px solid var(--border);background:#0b152b;color:var(--txt);padding:10px}
    textarea{width:100%;min-height:110px;border-radius:14px;border:1px solid var(--border);background:#0b152b;color:var(--txt);padding:10px}
    .kbd{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    .key{padding:12px 8px;border-radius:12px;border:1px solid var(--border);background:#0c1730;color:var(--txt);font-weight:900;cursor:pointer}
    .key.zero{background:rgba(245,158,11,.16);border-color:rgba(245,158,11,.35)}
    .key.green{background:rgba(16,185,129,.16);border-color:rgba(16,185,129,.35)}
    .key:active,.btn:active{transform:translateY(1px)}
    .hr{height:1px;background:var(--border);margin:12px 0}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Roulette Trend Tracker</h1>
    <div class="sub">
      <div style="margin-top:6px;color:#c7d2fe;font-weight:800;">Build: 2025-12-30 • working keypad</div>
      Tap spins. Saves on-device. (This is the “known-good” keypad build.)
    </div>

    <div class="card">
      <div class="row">
        <div class="pill">Spins (all): <b id="spinCount">0</b></div>
        <div class="pill">Session: <b id="sessionCount">0</b></div>
        <button class="btn" id="newSessionBtn" type="button">New Session</button>
        <button class="btn" id="undoBtn" type="button">Undo</button>
        <button class="btn danger" id="clearBtn" type="button">Clear All</button>
      </div>

      <div class="hr"></div>

      <div style="font-weight:900;margin-bottom:8px">Quick input</div>
      <div class="row">
        <div style="flex:1;min-width:180px">
          <input id="manualInput" type="text" placeholder="Type: 0–36 or 00" inputmode="text" />
        </div>
        <button class="btn primary" id="addManualBtn" type="button">Add</button>
      </div>
      <div class="small" style="margin-top:8px">Tip: keypad is usually fastest. Manual input is a backup.</div>

      <div class="hr"></div>

      <div id="keypadAnchor" style="font-weight:900;margin-bottom:8px">Tap keypad</div>
      <div class="kbd" id="kbd"></div>
    </div>

    <div class="card">
      <div style="font-weight:900;margin-bottom:8px">Last 20 (newest first)</div>
      <textarea id="lastList" readonly placeholder="No spins yet."></textarea>
      <div class="small" style="margin-top:8px">
        Storage key: <span style="font-family:ui-monospace,Menlo,Consolas,monospace;">roulette_trend_tracker_keypad_good_v1</span>
      </div>
    </div>
  </div>

<script>
(function(){
  "use strict";

  const STORAGE_KEY = "roulette_trend_tracker_keypad_good_v1";

  const $ = (id) => document.getElementById(id);

  let spins = [];        // newest-first: {n: number|string ("00"), t: ms, s: sessionId}
  let sessionId = 1;

  function numToKey(raw){
    if(raw === "00") return "00";
    if(typeof raw === "string" && raw.trim() === "00") return "00";
    const n = Number(raw);
    if(!Number.isFinite(n)) return null;
    if(n === 0) return 0;
    if(n >= 1 && n <= 36) return n;
    return null;
  }

  function save(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify({spins, sessionId}));
    }catch(e){}
  }

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const obj = JSON.parse(raw);
      if(Array.isArray(obj.spins)){
        spins = obj.spins.map(x => ({
          n: numToKey(x.n ?? x),
          t: Number(x.t) || Date.now(),
          s: Number(x.s) || 1
        })).filter(x => x.n !== null);
      }
      if(Number.isFinite(obj.sessionId)) sessionId = Number(obj.sessionId);
    }catch(e){}
  }

  function render(){
    $("spinCount").textContent = String(spins.length);
    $("sessionCount").textContent = String(spins.filter(x => x.s === sessionId).length);
    $("lastList").value = spins.slice(0,20).map(x => (x.n === "00" ? "00" : String(x.n))).join(", ");
  }

  function addSpin(val){
    const k = numToKey(val);
    if(k === null) return;
    spins.unshift({ n: k, t: Date.now(), s: sessionId });
    if(spins.length > 5000) spins = spins.slice(0,5000);
    save();
    render();
  }

  function undo(){
    if(spins.length === 0) return;
    spins.shift();
    save();
    render();
  }

  function clearAll(){
    if(!confirm("Clear ALL spins (this deletes stored history on this device)?")) return;
    spins = [];
    sessionId = 1;
    save();
    render();
  }

  function newSession(){
    sessionId += 1;
    save();
    render();
  }

  function buildKeypad(){
    const keys = ["00", 0];
    for(let i=1;i<=36;i++) keys.push(i);

    const kbd = $("kbd");
    kbd.innerHTML = "";

    keys.forEach(k => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "key";
      if(k === "00") b.className += " zero";
      if(k === 0) b.className += " green";
      b.textContent = String(k);
      b.addEventListener("click", () => addSpin(k), {passive:true});
      kbd.appendChild(b);
    });
  }

  // Wire UI
  $("undoBtn").addEventListener("click", undo);
  $("clearBtn").addEventListener("click", clearAll);
  $("newSessionBtn").addEventListener("click", newSession);

  $("addManualBtn").addEventListener("click", () => {
    const raw = $("manualInput").value.trim();
    if(!raw) return;
    if(raw === "00") addSpin("00");
    else if(/^[0-9]+$/.test(raw)) addSpin(Number(raw));
    $("manualInput").value = "";
  });

  $("manualInput").addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      e.preventDefault();
      $("addManualBtn").click();
    }
  });

  // Init
  buildKeypad();
  load();
  render();
})();
</script>
</body>
</html>
